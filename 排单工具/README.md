本工具用于给公司财务部门提供帮助，可以将汇总的数据表拆分生成明细表，再将明细表和简易财务系统生成的Excel表合并，从而生成完整的对账单。

主要使用的库和版本如下：

```
numpy = 1.25.2
openpyxl = 3.1.2 
pandas = 2.0.3
xlwings = 0.30.10
pyinstaller = 5.13.0
Python = 3.11.4
```

工具采用Python开发，使用numpy、openpyxl、pandas等库读取和处理Excel表格，使用xlwings与Excel交互，并用pyinstaller将Python代码打包成可执行文件，方便在没有Python环境的电脑上运行。

总体来说，本工具旨在提高公司财务对账工作的效率，通过自动化生成对账单明细，节省重复劳动。

# 使用步骤

1. 首先将数据复制到资料表的排单明细中，从第二行开始粘贴，不要覆盖表头。

2. 将“简易系统对账单”文件夹复制到程序所在目录下。

3. 如果资料表和模板已打开，请关闭。

4. 运行程序，按提示输入账期(格式为yyyymm，例如202309)。

5. 等待程序执行完成，如果提示错误请按提示排除故障。

6. 注意在程序运行期间不要打开生成的文件，否则可能因为文件被占用导致程序无法正常执行。
7. 程序执行完成后，结果文件存放在程序所在文件夹中的“输入的账期”文件夹以及“输入的账期-完整版”文件夹。 

# 注意事项

- 程序应与资料表.xlsx、模板.xlsx存放在同一目录下。


- 本程序仅支持xlsx格式的文件并且在合并两份Excel时，使用了xlswings，因此请确保系统是Windows并且安装了Office，如果不满足系统和软件的要求，最后一步的合并会报错，但是明细表仍然会正确生成。


- 请在资料表.xlsx的价目表1和价目表2中编辑好价目信息，其中价目表1用于存储协议价格，价目表2用于存储固定价格。


- 检测项目可以进行增删和重命名，但是需要同时修改资料表和模板，并保证资料表的排单明细、模板的使用明细和明细表的检测项目之间保持一致：


1. 资料表中的排单明细的`S1`至`倒数第五列1`可以进行修改，以当前长度为例，为`S1`至`FN1`。
2. 在价目表1或价目表2中可以修改检测项目的名称，其中价目表1可修改的范围是`B1`至`倒数第二列1`，价目表2的可修改范围是第二行至最后一行。
3. 需要确保模板中的明细表的第三行与资料表中的排单明细第一行完全一致。
4. 需要确保模板中的使用明细的`B4`至`B最后一行`的检测项目与明细表的`S1`至`倒数第五列1`的检测项目完全一致。 

- 模板中可以直接修改样式并同步到生成文件的部分：


1. 使用明细基本都可以修改。
2. 明细表的前三行。
3. 注意事项：请勿在空白行或空白列修改样式，这样会导致程序获取的行数或列数变大。在模板的使用明细和明细表中，只修改有数据的行和列的样式，避免影响程序的判断。


- “简易系统对账单”文件夹内的文件是财务简易系统生成的账单明细表，包含所有公司的账单信息。

- 本程序的合并逻辑是根据生成好的明细表文件名（文件名的的格式为：集团编号-协议号-协议单位[账单日期].xlsx）的集团编号，去匹配“简易系统对账单”内文件名的集团编号，匹配成功就会进行合并操作。

1. 本程序根据生成的明细表文件名中的集团编号，去匹配“简易系统对账单”内文件名中的集团编号进行合并。明细表文件名格式为:集团编号-协议号-协议单位[账单日期].xlsx。在编写代码时，参考的对账单文件名格式为“yyyy-mm-集团编号-xxx-xxx.xlsx”，故程序是取文件名第二第三个“-”之间的内容作为集团编号。但实际上对账单不仅有系统生成，还有手工编写。手工编写时，请确保文件名中集团编号前有两个"-"，后有至少一个“-”，例如:"--集团编号-.xlsx"、"2023-09-集团编号-.xlsx"、"-202309-集团编号--.xlsx"等格式，以便正确读取集团编号。
2. 对于手工命名的文件集团编号前缺少“-”可以参考下面的方法批量添加“-”：先将这些文件移动到一个单独的文件夹，在该文件夹空白处按住Shift键右击，选择“在此处打开Powershell窗口”，粘贴命令`Get-ChildItem | Rename-Item -NewName {$_.Name -replace '^'，'-'}`并回车执行，即可在所有文件名开头添加一个“-”。可以重复执行此命令，每次执行都会额外添加一个“-”。添加完毕后，再将这些文件移回“简易系统对账单”文件夹，即可进行后续的排单合并操作。
3. 合并后的文件名与原对账单文件名一致。如果之前批量添加了“-”，可以在完整版文件夹右键点击“在此处打开Powershell窗口”，输入`Get-ChildItem | Rename-Item -NewName {$_.Name -replace '^-'}`命令回车执行，即可批量删除文件名开头的“-”。重复执行以全部删除。

